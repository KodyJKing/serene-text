<!DOCTYPE html>
<html>
    <head>
        <brion>
        <title>Serene Text</title>

        <style>
            .ace_scrollbar {
                filter: brightness(0.2)
            }

            .ace_gutter {
                filter: opacity(50%)
            }

            .ace_autocomplete {
                filter: opacity(75%)
            }
        </style>

    </head>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-beautify.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-language_tools.js'></script>

    <body style="margin:0;overflow:hidden">
        <script type='ion'>
                const
                    serenetext = import 'serenetext'
                    {VideoLoop} = serenetext

                    overlayColor = 'rgba(10, 10, 10, 1)'

                    save() ->
                        localStorage.file = editor.getValue()

                    load() ->
                        if localStorage.file?
                            editor.setValue(localStorage.file)

                    run() ->
                        let code = '(function(){' + editor.getValue() + '})()'
                        eval(code)

                let state = {}
                    consoleOpen: false

                activate template ->
                    window
                        error(e) ->
                            console.error(e)
                        document:
                            keydown(e) ->
                                if e.keyCode is 83 and e.ctrlKey
                                    e.preventDefault()
                                    save()

                                if e.keyCode is 82 and e.ctrlKey
                                    e.preventDefault()
                                    run()

                                if e.keyCode is 192 and e.ctrlKey
                                    e.preventDefault()
                                    state.consoleOpen = not state.consoleOpen

                            title: "Serene Text"
                            body:
                                # VideoLoop('https://www.youtube.com/watch?v=Ftm2uv7-Ybw')
                                VideoLoop('https://www.youtube.com/watch?v=pO2_D2iDz30')
                                # VideoLoop('https://www.youtube.com/watch?v=aK4JSwhdcdE')
                                # VideoLoop('https://www.youtube.com/watch?v=8F1-1j_ZDgc')
                                # VideoLoop('https://www.youtube.com/watch?v=Y4KX-owEk98')
                                Div(id: 'editor')
                                    style:
                                        # left: '20%', right: '20%'
                                        left: '25%', right: '25%'
                                        top: '0px', bottom: '0px'
                                        position: 'absolute'
                                        background: overlayColor
                                        filter: 'opacity(75%)'

                                Div(id: 'output')
                                    style:
                                        right: '0%', width: '20%'
                                        top: '0px', bottom: '0px'
                                        position: 'absolute'
                                        background: overlayColor
                                        filter: 'opacity(75%)'
                                        display: state.consoleOpen ? 'initial' : 'none'

                ace.require("ace/ext/beautify")
                ace.require("ace/ext/language_tools")

                let editor = ace.edit(..)
                    'editor', {}
                        mode: "ace/mode/javascript"
                        selectionStyle: "text"
                editor.setTheme("ace/theme/monokai")
                editor.setShowPrintMargin(false)
                editor.setOptions(enableBasicAutocompletion: true, enableLiveAutocompletion: true)

                let output = ace.edit(..)
                    'output', {}
                        selectionStyle: "text"
                output.setTheme("ace/theme/monokai")
                output.setShowPrintMargin(false)
                output.renderer.setShowGutter(false)
                output.setReadOnly(true)

                load()

                let oldLog = console.log
                console.log = (o) ->
                    output.session.insert(..)
                        { row: output.session.getLength(), column: 0 }
                        '\n' + Array.from(arguments).join(' ')
                    oldLog.apply(null, arguments)

            </script>
    </body>
</html>