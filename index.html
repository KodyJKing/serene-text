<!DOCTYPE html>
<html>
    <head>
        <script src='node_modules/ion/lib/browser/require.js'></script>
<script src='node_modules/ion/lib/Object.js'></script>
<script src='node_modules/ion/lib/browser/elements.js'></script>
<script src='node_modules/ion/lib/browser/index.js'></script>
<script src='node_modules/ion/lib/browser/tester.js'></script>
<script src='node_modules/ion/lib/builder/Directory.js'></script>
<script src='node_modules/ion/lib/builder/File.js'></script>
<script src='node_modules/ion/lib/builder/ModuleBuilder.js'></script>
<script src='node_modules/ion/lib/builder/WebsiteBuilder.js'></script>
<script src='node_modules/ion/lib/builder/index.js'></script>
<script src='node_modules/ion/lib/builder/nodash.js'></script>
<script src='node_modules/ion/lib/builder/utility.js'></script>
<script src='node_modules/ion/lib/builder/watcher.js'></script>
<script src='node_modules/ion/lib/compiler/astFunctions.js'></script>
<script src='node_modules/ion/lib/compiler/common.js'></script>
<script src='node_modules/ion/lib/compiler/escodegen/index.js'></script>
<script src='node_modules/ion/lib/compiler/estraverse/index.js'></script>
<script src='node_modules/ion/lib/compiler/esutils/code.js'></script>
<script src='node_modules/ion/lib/compiler/esutils/index.js'></script>
<script src='node_modules/ion/lib/compiler/esutils/keyword.js'></script>
<script src='node_modules/ion/lib/compiler/index.js'></script>
<script src='node_modules/ion/lib/compiler/nodes.js'></script>
<script src='node_modules/ion/lib/compiler/parser.js'></script>
<script src='node_modules/ion/lib/compiler/postprocessor.js'></script>
<script src='node_modules/ion/lib/compiler/preprocessor.js'></script>
<script src='node_modules/ion/lib/compiler/traverse.js'></script>
<script src='node_modules/ion/lib/compiler/traverseAst.js'></script>
<script src='node_modules/ion/lib/es6/Array.js'></script>
<script src='node_modules/ion/lib/es6/CustomEvent.js'></script>
<script src='node_modules/ion/lib/es6/Element.closest.js'></script>
<script src='node_modules/ion/lib/es6/Function.js'></script>
<script src='node_modules/ion/lib/es6/Map.js'></script>
<script src='node_modules/ion/lib/es6/Object.js'></script>
<script src='node_modules/ion/lib/es6/Object.observe.js'></script>
<script src='node_modules/ion/lib/es6/Set.js'></script>
<script src='node_modules/ion/lib/es6/String.js'></script>
<script src='node_modules/ion/lib/es6/index.js'></script>
<script src='node_modules/ion/lib/es6/sugar.js'></script>
<script src='node_modules/ion/lib/index.js'></script>
<script src='node_modules/ion/lib/mergePatch.js'></script>
<script src='node_modules/ion/lib/runtime/ArrayExpression.js'></script>
<script src='node_modules/ion/lib/runtime/BlockStatement.js'></script>
<script src='node_modules/ion/lib/runtime/CallExpression.js'></script>
<script src='node_modules/ion/lib/runtime/ConditionalExpression.js'></script>
<script src='node_modules/ion/lib/runtime/Context.js'></script>
<script src='node_modules/ion/lib/runtime/DynamicExpression.js'></script>
<script src='node_modules/ion/lib/runtime/Expression.js'></script>
<script src='node_modules/ion/lib/runtime/ExpressionStatement.js'></script>
<script src='node_modules/ion/lib/runtime/Factory.js'></script>
<script src='node_modules/ion/lib/runtime/ForInOfStatement.js'></script>
<script src='node_modules/ion/lib/runtime/IfStatement.js'></script>
<script src='node_modules/ion/lib/runtime/Literal.js'></script>
<script src='node_modules/ion/lib/runtime/MemberExpression.js'></script>
<script src='node_modules/ion/lib/runtime/Node.js'></script>
<script src='node_modules/ion/lib/runtime/ObjectExpression.js'></script>
<script src='node_modules/ion/lib/runtime/OperationExpression.js'></script>
<script src='node_modules/ion/lib/runtime/Property.js'></script>
<script src='node_modules/ion/lib/runtime/ReturnStatement.js'></script>
<script src='node_modules/ion/lib/runtime/Statement.js'></script>
<script src='node_modules/ion/lib/runtime/Template.js'></script>
<script src='node_modules/ion/lib/runtime/UndoStatement.js'></script>
<script src='node_modules/ion/lib/runtime/VariableDeclaration.js'></script>
<script src='node_modules/ion/lib/runtime/index.js'></script>
<script src='node_modules/ion/lib/test/ClassDeclarators.js'></script>
<script src='node_modules/ion/lib/test/classDeclarators.js'></script>
<script src='node_modules/ion/lib/test/duplicateDeclares.js'></script>
<script src='node_modules/ion/lib/test/es6Scoping.js'></script>
<script src='node_modules/ion/lib/test/immediateTemplates.js'></script>
<script src='node_modules/ion/lib/test/index.js'></script>
<script src='node_modules/ion/lib/test/ionCompiler.js'></script>
<script src='node_modules/ion/lib/test/ionCompilerES5.js'></script>
<script src='node_modules/ion/lib/test/reactiveTemplates.js'></script>
<script src='node_modules/ion/lib/test/sourceSize.js'></script>
<script src='node_modules/ion/lib/test/syntax.js'></script>
<script src='lib/VideoLoop.js'></script>
<script src='lib/index.js'></script>
        <title>Serene Text</title>

        <style>
            .ace_scrollbar {
                filter: brightness(0.2)
            }

            .ace_gutter {
                filter: opacity(50%)
            }

            .ace_autocomplete {
                filter: opacity(75%)
            }
        </style>

    </head>

    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ace.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-beautify.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/ace/1.3.3/ext-language_tools.js'></script>

    <body style="margin:0;overflow:hidden">
        <script type='ion'>
                const
                    serenetext = import 'serenetext'
                    {VideoLoop} = serenetext

                    overlayColor = 'rgba(10, 10, 10, 1)'

                    save() ->
                        localStorage.file = editor.getValue()

                    load() ->
                        if localStorage.file?
                            editor.setValue(localStorage.file)

                    run() ->
                        let code = '(function(){' + editor.getValue() + '})()'
                        eval(code)

                let state = {}
                    consoleOpen: false

                activate template ->
                    window
                        error(e) ->
                            console.error(e)
                        document:
                            keydown(e) ->
                                if e.keyCode is 83 and e.ctrlKey
                                    e.preventDefault()
                                    save()

                                if e.keyCode is 82 and e.ctrlKey
                                    e.preventDefault()
                                    run()

                                if e.keyCode is 192 and e.ctrlKey
                                    e.preventDefault()
                                    state.consoleOpen = not state.consoleOpen

                            title: "Serene Text"
                            body:
                                # VideoLoop('https://www.youtube.com/watch?v=Ftm2uv7-Ybw')
                                VideoLoop('https://www.youtube.com/watch?v=pO2_D2iDz30')
                                # VideoLoop('https://www.youtube.com/watch?v=aK4JSwhdcdE')
                                # VideoLoop('https://www.youtube.com/watch?v=8F1-1j_ZDgc')
                                # VideoLoop('https://www.youtube.com/watch?v=Y4KX-owEk98')
                                Div(id: 'editor')
                                    style:
                                        # left: '20%', right: '20%'
                                        left: '25%', right: '25%'
                                        top: '0px', bottom: '0px'
                                        position: 'absolute'
                                        background: overlayColor
                                        filter: 'opacity(75%)'

                                Div(id: 'output')
                                    style:
                                        right: '0%', width: '20%'
                                        top: '0px', bottom: '0px'
                                        position: 'absolute'
                                        background: overlayColor
                                        filter: 'opacity(75%)'
                                        display: state.consoleOpen ? 'initial' : 'none'

                ace.require("ace/ext/beautify")
                ace.require("ace/ext/language_tools")

                let editor = ace.edit(..)
                    'editor', {}
                        mode: "ace/mode/javascript"
                        selectionStyle: "text"
                editor.setTheme("ace/theme/monokai")
                editor.setShowPrintMargin(false)
                editor.setOptions(enableBasicAutocompletion: true, enableLiveAutocompletion: true)

                let output = ace.edit(..)
                    'output', {}
                        selectionStyle: "text"
                output.setTheme("ace/theme/monokai")
                output.setShowPrintMargin(false)
                output.renderer.setShowGutter(false)
                output.setReadOnly(true)

                load()

                let oldLog = console.log
                console.log = (o) ->
                    output.session.insert(..)
                        { row: output.session.getLength(), column: 0 }
                        '\n' + Array.from(arguments).join(' ')
                    oldLog.apply(null, arguments)

            </script>
    </body>
</html>